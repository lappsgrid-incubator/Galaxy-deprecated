function init_tag_click_function(a,b){$(a).find(".tag-name").each(function(){$(this).click(function(){var a=$(this).text(),c=a.split(":");return b(c[0],c[1]),!0})})}jQuery.fn.autocomplete_tagging=function(a){function b(a){$(a).mouseenter(function(){$(this).attr("src",e.delete_tag_img_rollover)}),$(a).mouseleave(function(){$(this).attr("src",e.delete_tag_img)}),$(a).click(function(){var b=$(this).parent(),c=b.find(".tag-name").eq(0),d=c.text(),f=d.split(":"),i=f[0],j=f[1],k=b.prev();b.remove(),delete e.tags[i];var l=e.get_toggle_link_text_fn(e.tags);return h.text(l),$.ajax({url:e.ajax_delete_tag_url,data:{tag_name:i},error:function(){e.tags[i]=j,k.hasClass("tag-button")?k.after(b):g.prepend(b),alert("Remove tag failed"),h.text(e.get_toggle_link_text_fn(e.tags)),a.mouseenter(function(){$(this).attr("src",e.delete_tag_img_rollover)}),a.mouseleave(function(){$(this).attr("src",e.delete_tag_img)})},success:function(){}}),!0})}function c(a){var c=$("<img/>").attr("src",e.delete_tag_img).addClass("delete-tag-img");b(c);var d=$("<span>").text(a).addClass("tag-name");d.click(function(){var b=a.split(":");return e.tag_click_fn(b[0],b[1]),!0});var f=$("<span></span>").addClass("tag-button");return f.append(d),e.editable&&f.append(c),f}var d={get_toggle_link_text_fn:function(a){var b="",c=obj_length(a);return b=c>0?c+(c>1?" Tags":" Tag"):"Add tags"},tag_click_fn:function(){},editable:!0,input_size:20,in_form:!1,tags:{},use_toggle_link:!0,item_id:"",add_tag_img:"",add_tag_img_rollover:"",delete_tag_img:"",ajax_autocomplete_tag_url:"",ajax_retag_url:"",ajax_delete_tag_url:"",ajax_add_tag_url:""},e=jQuery.extend(d,a),f=$(this),g=f.find(".tag-area"),h=f.find(".toggle-link"),i=f.find(".tag-input"),j=f.find(".add-tag-button");h.click(function(){var a;return a=g.is(":hidden")?function(){var a=$(this).find(".tag-button").length;0===a&&g.click()}:function(){g.blur()},g.slideToggle("fast",a),$(this)}),e.editable&&i.hide(),i.keyup(function(a){if(27===a.keyCode)$(this).trigger("blur");else if(13===a.keyCode||188===a.keyCode||32===a.keyCode){var b=this.value;if(-1!==b.indexOf(": ",b.length-2))return this.value=b.substring(0,b.length-1),!1;if((188===a.keyCode||32===a.keyCode)&&(b=b.substring(0,b.length-1)),b=$.trim(b),b.length<2)return!1;this.value="";var d=c(b),f=g.children(".tag-button");if(0!==f.length){var i=f.slice(f.length-1);i.after(d)}else g.prepend(d);var j=b.split(":");e.tags[j[0]]=j[1];var k=e.get_toggle_link_text_fn(e.tags);h.text(k);var l=$(this);return $.ajax({url:e.ajax_add_tag_url,data:{new_tag:b},error:function(){d.remove(),delete e.tags[j[0]];var a=e.get_toggle_link_text_fn(e.tags);h.text(a),alert("Add tag failed")},success:function(){l.data("autocompleter").cacheFlush()}}),!1}});var k=function(a,b,c,d){var e=d.split(":");return 1===e.length?e[0]:e[1]},l={selectFirst:!1,formatItem:k,autoFill:!1,highlight:!1};i.autocomplete(e.ajax_autocomplete_tag_url,l),f.find(".delete-tag-img").each(function(){b($(this))}),init_tag_click_function($(this),e.tag_click_fn),j.click(function(){return $(this).hide(),g.click(),!1}),e.editable&&(g.bind("blur",function(){obj_length(e.tags)>0&&(j.show(),i.hide(),g.removeClass("active-tag-area"))}),g.click(function(a){var b=$(this).hasClass("active-tag-area");if($(a.target).hasClass("delete-tag-img")&&!b)return!1;if($(a.target).hasClass("tag-name")&&!b)return!1;$(this).addClass("active-tag-area"),j.hide(),i.show(),i.focus();var c=function(a){var b=function(a,b){a.attr("id");b!==a&&(a.blur(),$(window).unbind("click.tagging_blur"),$(this).addClass("tooltip"))};b(g,$(a.target))};return $(window).bind("click.tagging_blur",c),!1})),e.use_toggle_link&&g.hide()};
//# sourceMappingURL=../maps/galaxy.autocom_tagging.js.map